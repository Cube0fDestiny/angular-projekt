<div class="relative inline-block">
  <!-- Trigger button -->
  <div
    class="relative w-7 h-7 md:w-8 md:h-8 flex items-center justify-center cursor-pointer rounded-lg hover:bg-white/10 transition-colors"
    (click)="toggleDropdown()"> 
    <img class="w-6 h-6 md:w-7 md:h-7 object-contain" [src]="getNotificationIcon()">
    <span 
      *ngIf="friendRequests.length > 0" 
      class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold min-w-[18px] h-[18px] rounded-full flex items-center justify-center px-1 ring-2 ring-[var(--o-orange)]"
    >
      {{ friendRequests.length }}
    </span>
  </div> 

  <!-- Dropdown content -->
  <div 
    *ngIf="isOpen" 
    class="absolute top-full right-0 mt-3 min-w-[300px] max-w-[340px] bg-[var(--o-beige)] border-2 border-[var(--o-green)] rounded-2xl shadow-[0_8px_30px_rgba(0,0,0,0.12)] z-[1000] animate-slideDown overflow-hidden"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div class="px-4 py-3 bg-[var(--o-green)]/5 border-b border-[var(--o-green)]/10 flex items-center justify-between">
      <span class="text-[var(--o-green)] font-semibold text-sm uppercase tracking-wide">Powiadomienia</span>
      <span 
        *ngIf="friendRequests.length > 0" 
        class="bg-[var(--o-orange)] text-white text-xs font-bold px-2 py-0.5 rounded-full"
      >
        {{ friendRequests.length }} nowe
      </span>
    </div>
    
    <!-- Friend requests list -->
    <div *ngIf="friendRequests.length > 0" class="max-h-[320px] overflow-y-auto">
      <div 
        *ngFor="let friendRequest of friendRequests; let last = last" 
        class="p-4 hover:bg-[var(--o-orange)]/5 transition-all duration-200"
        [class.border-b]="!last"
        [class.border-[var(--o-green)]/10]="!last"
      >
        <div class="flex items-center gap-3">
          <img 
            [src]="friendRequest[1]!.avatar" 
            alt="User" 
            class="w-11 h-11 rounded-full object-cover ring-2 ring-[var(--o-orange)]/20"
          >
          <div class="flex-1 min-w-0">
            <span class="text-[var(--o-green)] font-semibold block truncate">{{friendRequest[1]!.name}}</span>
            <span class="text-[var(--o-green)]/60 text-sm">Chce zostać znajomym</span>
          </div>
        </div>
        <div class="flex gap-2 mt-3">
          <button 
            class="flex-1 py-2 px-3 bg-[var(--o-green)] text-white font-medium text-sm rounded-lg hover:bg-[var(--o-dgreen)] transition-colors"
            (click)="acceptFriendRequest(friendRequest[0])"
          >
            Akceptuj
          </button>
          <button 
            class="flex-1 py-2 px-3 bg-transparent text-[var(--o-green)] font-medium text-sm rounded-lg border-2 border-[var(--o-green)]/30 hover:bg-[var(--o-green)]/10 transition-colors"
            (click)="rejectFriendRequest(friendRequest[0])"
          >
            Odrzuć
          </button>
        </div>
      </div>
    </div>
    
    <!-- Empty state -->
    <div 
      *ngIf="friendRequests.length === 0" 
      class="py-10 px-6 text-center"
    >
      <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-[var(--o-green)]/10 flex items-center justify-center">
        <svg class="w-8 h-8 text-[var(--o-green)]/40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
        </svg>
      </div>
      <p class="text-[var(--o-green)] font-semibold text-lg">Brak powiadomień</p>
      <p class="text-[var(--o-green)]/60 text-sm mt-1">Nie masz nowych zaproszeń</p>
    </div>
  </div>
</div>

<!-- Backdrop to close when clicking outside -->
<div *ngIf="isOpen" class="fixed inset-0 z-[999]" (click)="closeDropdown()"></div>