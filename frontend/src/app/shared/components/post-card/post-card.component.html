<div class="post-card" >
  
   <!-- Post Image <div class="post-card" [class.with-image]="post.imageUrl">
    <img 
      *ngIf="post.imageUrl" 
      [src]="post.imageUrl" 
      [alt]="'Image in post by ' + post.author.name"
      class="post-image" >-->
    <img src="assets/images/orange-grove.png" alt="Orang">
  <!-- Post Header -->
  <div class="post-header">
    <div *ngIf="isLoading">Loading...</div>
    <img *ngIf="user && !isLoading" (click)="goToProfile(user.id)" [src]="userProfilePicture" [alt]="user.name" class="author-avatar">
    
    <div *ngIf="user && !isLoading" class="author-info">
      <div class="author-name" (click)="goToProfile(user.id)">{{ user.name }}</div>
      <div class="post-meta">
        <span class="post-time">{{ timeAgo }}</span>
      </div>
    </div>
    
    <button class="more-options" *ngIf="currentUserId === post.creator_id">
      ‚ãÆ
    </button>
  </div>
  
  <!-- Post Content -->
  <div class="post-content">
    <app-text-display variant="white">{{ post.Text }}</app-text-display>
  </div>
  
  <!-- Post Stats-->
  <div class="post-stats" *ngIf="(orang_count + comment_count) > 0">
    <span *ngIf="orang_count > 0" class="likes-count">
      üçä {{ orang_count }}
    </span>
    <span *ngIf="comment_count > 0" class="comments-count">
      üí¨ {{ comment_count }}
    </span>
  </div>
  
  <!-- Post Actions -->
  <div class="post-actions" *ngIf="showActions">
    <!-- <orang-button (click)="onLike()">
      <span>üçä Orang it</span>
    </orang-button> -->

    <orang-button [isActive]="!userReacted" [istoggleable]="false" (click)="toggleUserReaction()">
      <span>üçä Orang</span>
    </orang-button>
    
    <orang-button (click)="toggleComments()">
      <span>üí¨ Comments</span>
    </orang-button>
    
    <orang-button 
      [istoggleable]="false" 
      (click)="copyPostLink(post.id)"
      [disabled]="isCopying"
      class="relative"
    >
      <span *ngIf="!copied">{{ copyButtonText }}</span>
      <span *ngIf="copied" class="flex items-center gap-1">
        ‚úÖ Squeezed!
      </span>
    </orang-button>
  </div>
  
  <!-- Comment Input -->
  <div class="comment-input" *ngIf="showComments">
    <form (ngSubmit)="addComment()" class="input-container">
      <input 
        type="text"
        name="newComment"
        placeholder="Write a comment..."
        [(ngModel)]="newComment"
        class="comment-input-field">
      
      <orang-button size="small" type="submit" [istoggleable]=false>
        Post
      </orang-button>
    </form>
  </div>
  <!-- Comments Section -->
  <div class="comments-section" *ngIf="showComments && !loadingComments && comments.length > 0">
    <div class="comment" *ngFor="let comment of comments">
      <img [src]="comment.user?.profile_picture_url" [alt]="comment.user?.name||'User'" class="comment-avatar" (click)="goToProfile(comment!.user!.id)">
      
      <div class="comment-content">
        <div class="comment-header">
          <span class="comment-author">{{ comment.user?.name }}</span>
          <span class="comment-time">{{ comment?.displayDate }}</span>
        </div>
        
        <div *ngIf="!!!comment.in_reply_to" class="comment-text">
          {{ comment.text }}
        </div>
        
        <!-- Reply comment -->
        <div *ngIf="!!comment.in_reply_to" class="comment-text">
          <button (click)="goToProfile(comment.parentUser!.id)" class="reply-button">
            Repling to {{ comment.parentUser?.name }}
          </button>
          {{ comment?.text }}
        </div>
        
        <div *ngIf="comment.user?.id != currentUser?.id" class="comment-input">
          <orang-button 
            size="small" 
            [istoggleable]=false
            (click)="toggleReplyForm(comment)"
          >
            {{ comment.showReplyForm ? 'Cancel' : 'Reply' }}
          </orang-button>
          
          <form 
            *ngIf="comment.showReplyForm"
            (ngSubmit)="addReply(comment)"
            class="input-container"
          >
            <input 
              [(ngModel)]="replyText"
              name="replyText"
              placeholder="Write a reply..."
              class="comment-input-field"
            />
            
            <orang-button 
              size="small" 
              type="submit"
              untoggleable="true"

            >
              Post
            </orang-button>
          </form>
        </div>

        <div class="comment-input" *ngIf="comment.user?.id == currentUser?.id">
          <orang-button 
            size="small" 
            [istoggleable]="false"
            (click)="deleteComment(comment)"
          >
            Delete
          </orang-button>

          <orang-button 
            size="small" 
            [istoggleable]="false"
            (click)="toggleEditForm(comment)"
          >
            Edit
          </orang-button>
          
          <form 
            *ngIf="comment.showEditForm"
            (ngSubmit)="editComment(comment)"
            class="input-container"
          >
            <input 
              [(ngModel)]="comment.editText"
              name="editText"
              placeholder="Edit Comment"
              class="comment-input-field"
            />
            
            <orang-button 
              size="small" 
              type="submit"
              [istoggleable]="true"
            >
              Confirm
            </orang-button>
          </form>
        </div>

      </div>
    </div>
  </div>

  <div 
  class="post-actions flex flex-col gap-3 px-4 pb-4 ml-16 mr-8 mb-3"
  *ngIf="user?.id == currentUser?.id"
>
  <!-- Top row: Action buttons on left, save button on right (when editing) -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
    <!-- Left: Stacked buttons -->
    <div class="flex flex-col sm:flex-row gap-2">
      <orang-button 
        size="small" 
        [istoggleable]="false"
        (click)="deletePost()"
        class="w-full sm:w-32"
      >
        Delete Post
      </orang-button>

      <orang-button 
        size="small" 
        [istoggleable]="false"
        (click)="toggleEditPostForm()"
        class="w-full sm:w-32"
      >
        {{ showEditPostForm ? 'Cancel Edit' : 'Edit Post' }}
      </orang-button>
    </div>
    
    <!-- Right: Save button (only shown when editing) -->
    <orang-button 
      *ngIf="showEditPostForm"
      size="small" 
      type="submit"
      [istoggleable]="true"
      (click)="editPost()"
      class="w-full sm:w-auto min-w-[120px]"
    >
      Save Changes
    </orang-button>
  </div>
  
  <!-- Edit Post Form - Full width below buttons -->
  <form 
    *ngIf="showEditPostForm"
    (ngSubmit)="editPost()"
    class="edit-post-form w-full"
  >
    <app-text-display variant="white" class="text-lg w-full">
      <textarea
        [(ngModel)]="editPostText"
        name="editPostText"
        placeholder="Write something Orang!"
        rows="3"
        class="w-full bg-transparent border border-none rounded-lg p-3 focus:outline-none focus:ring-none focus:border-transparent resize-y min-h-[100px]"
      ></textarea>
    </app-text-display>
  </form>
</div>
</div>